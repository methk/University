"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var rxjs_1 = require("rxjs");
var typescript_map_1 = require("typescript-map");
var RadixKeyPair_1 = tslib_1.__importDefault(require("../wallet/RadixKeyPair"));
var RadixTokenManager_1 = require("../token/RadixTokenManager");
var RadixConfig_1 = require("../common/RadixConfig");
var RadixAtomModel_1 = require("../RadixAtomModel");
var RadixTransferAccountSystem = /** @class */ (function () {
    function RadixTransferAccountSystem(keyPair) {
        this.keyPair = keyPair;
        this.name = 'TRANSFER';
        this.transactions = new typescript_map_1.TSMap();
        this.balance = {};
        this.transactionSubject = new rxjs_1.Subject();
        this.unspentConsumables = new typescript_map_1.TSMap();
        this.spentConsumables = new typescript_map_1.TSMap();
        // Add default radix token to balance
        this.balance[RadixTokenManager_1.radixTokenManager.getTokenByISO(RadixConfig_1.radixConfig.mainTokenISO).id.toString()] = 0;
        this.balanceSubject = new rxjs_1.BehaviorSubject(this.balance);
    }
    RadixTransferAccountSystem.prototype.processAtomUpdate = function (atomUpdate) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var atom;
            return tslib_1.__generator(this, function (_a) {
                atom = atomUpdate.atom;
                if (atom.serializer !== RadixAtomModel_1.RadixTransactionAtom.SERIALIZER) {
                    return [2 /*return*/];
                }
                if (atomUpdate.action === 'STORE') {
                    this.processStoreAtom(atom);
                }
                else if (atomUpdate.action === 'DELETE') {
                    this.processDeleteAtom(atom);
                }
                return [2 /*return*/];
            });
        });
    };
    RadixTransferAccountSystem.prototype.processStoreAtom = function (atom) {
        var e_1, _a, e_2, _b, e_3, _c;
        // Skip existing atoms
        if (this.transactions.has(atom.hid.toString())) {
            return;
        }
        var transactionUpdate = {
            action: 'STORE',
            hid: atom.hid.toString(),
            transaction: {
                hid: atom.hid.toString(),
                balance: {},
                fee: 0,
                participants: {},
                timestamp: atom.timestamps.default,
                message: ''
            }
        };
        var transaction = transactionUpdate.transaction;
        // Get transaction message
        if (typeof atom.payload === 'string') {
            transaction.message = atom.payload;
        }
        try {
            // Get transaction details
            for (var _d = tslib_1.__values(atom.particles), _e = _d.next(); !_e.done; _e = _d.next()) {
                var particle = _e.value;
                var tokenId = particle.asset_id.toString();
                if (!RadixTokenManager_1.radixTokenManager.getTokenByID(tokenId)) {
                    throw new Error('Unsuporeted Token Class');
                }
                var ownedByMe = false;
                try {
                    for (var _f = (e_2 = void 0, tslib_1.__values(particle.owners)), _g = _f.next(); !_g.done; _g = _f.next()) {
                        var owner = _g.value;
                        if (owner.public.data.equals(this.keyPair.getPublic())) {
                            ownedByMe = true;
                            break;
                        }
                    }
                }
                catch (e_2_1) { e_2 = { error: e_2_1 }; }
                finally {
                    try {
                        if (_g && !_g.done && (_b = _f.return)) _b.call(_f);
                    }
                    finally { if (e_2) throw e_2.error; }
                }
                var isFee = particle.serializer === RadixAtomModel_1.RadixAtomFeeConsumable.SERIALIZER;
                if (ownedByMe && !isFee) {
                    var quantity = 0;
                    if (particle.serializer === RadixAtomModel_1.RadixConsumer.SERIALIZER) {
                        quantity -= particle.quantity;
                        this.unspentConsumables.delete(particle._id);
                        this.spentConsumables.set(particle._id, particle);
                    }
                    else if (particle.serializer === RadixAtomModel_1.RadixConsumable.SERIALIZER ||
                        particle.serializer === RadixAtomModel_1.RadixEmission.SERIALIZER) {
                        quantity += particle.quantity;
                        if (!this.spentConsumables.has(particle._id)) {
                            this.unspentConsumables.set(particle._id, particle);
                        }
                    }
                    if (!(tokenId in transaction.balance)) {
                        transaction.balance[tokenId] = 0;
                    }
                    transaction.balance[tokenId] += quantity;
                }
                else if (!ownedByMe && !isFee) {
                    try {
                        for (var _h = (e_3 = void 0, tslib_1.__values(particle.owners)), _j = _h.next(); !_j.done; _j = _h.next()) {
                            var owner = _j.value;
                            var keyPair = RadixKeyPair_1.default.fromRadixECKeyPair(owner);
                            transaction.participants[keyPair.getAddress()] = keyPair.getAddress();
                        }
                    }
                    catch (e_3_1) { e_3 = { error: e_3_1 }; }
                    finally {
                        try {
                            if (_j && !_j.done && (_c = _h.return)) _c.call(_h);
                        }
                        finally { if (e_3) throw e_3.error; }
                    }
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_e && !_e.done && (_a = _d.return)) _a.call(_d);
            }
            finally { if (e_1) throw e_1.error; }
        }
        this.transactions.set(transactionUpdate.hid, transaction);
        // Update balance
        for (var tokenId in transaction.balance) {
            if (!(tokenId in this.balance)) {
                this.balance[tokenId] = 0;
            }
            this.balance[tokenId] += transaction.balance[tokenId];
        }
        this.balanceSubject.next(this.balance);
        this.transactionSubject.next(transactionUpdate);
    };
    RadixTransferAccountSystem.prototype.processDeleteAtom = function (atom) {
        var e_4, _a, e_5, _b;
        // Skip nonexisting atoms
        if (!this.transactions.has(atom.hid.toString())) {
            return;
        }
        var hid = atom.hid.toString();
        var transaction = this.transactions.get(hid);
        var transactionUpdate = {
            action: 'DELETE',
            hid: hid,
            transaction: transaction,
        };
        try {
            // Update consumables
            for (var _c = tslib_1.__values(atom.particles), _d = _c.next(); !_d.done; _d = _c.next()) {
                var particle = _d.value;
                var tokenId = particle.asset_id.toString();
                if (!RadixTokenManager_1.radixTokenManager.getCurrentTokens()[tokenId]) {
                    throw new Error('Unsuporeted Token Class');
                }
                var ownedByMe = false;
                try {
                    for (var _e = (e_5 = void 0, tslib_1.__values(particle.owners)), _f = _e.next(); !_f.done; _f = _e.next()) {
                        var owner = _f.value;
                        if (owner.public.data.equals(this.keyPair.getPublic())) {
                            ownedByMe = true;
                            break;
                        }
                    }
                }
                catch (e_5_1) { e_5 = { error: e_5_1 }; }
                finally {
                    try {
                        if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                    }
                    finally { if (e_5) throw e_5.error; }
                }
                var isFee = particle.serializer === RadixAtomModel_1.RadixAtomFeeConsumable.SERIALIZER;
                if (ownedByMe && !isFee) {
                    if (particle.serializer === RadixAtomModel_1.RadixConsumer.SERIALIZER) {
                        this.unspentConsumables.set(particle._id, particle);
                        this.spentConsumables.delete(particle._id);
                    }
                    else if (particle.serializer === RadixAtomModel_1.RadixConsumable.SERIALIZER ||
                        particle.serializer === RadixAtomModel_1.RadixEmission.SERIALIZER) {
                        this.unspentConsumables.delete(particle._id);
                    }
                }
            }
        }
        catch (e_4_1) { e_4 = { error: e_4_1 }; }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
            }
            finally { if (e_4) throw e_4.error; }
        }
        // Update balance
        for (var tokenId in transaction.balance) {
            if (!(tokenId in this.balance)) {
                this.balance[tokenId] = 0;
            }
            this.balance[tokenId] -= transaction.balance[tokenId];
        }
        this.balanceSubject.next(this.balance);
        this.transactionSubject.next(transactionUpdate);
    };
    RadixTransferAccountSystem.prototype.getAllTransactions = function () {
        var _this = this;
        return rxjs_1.Observable.create(function (observer) {
            var e_6, _a;
            try {
                // Send all old transactions
                for (var _b = tslib_1.__values(_this.transactions.values()), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var transaction = _c.value;
                    var transactionUpdate = {
                        action: 'STORE',
                        hid: transaction.hid,
                        transaction: transaction
                    };
                    observer.next(transactionUpdate);
                }
            }
            catch (e_6_1) { e_6 = { error: e_6_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_6) throw e_6.error; }
            }
            // Subscribe for new ones
            _this.transactionSubject.subscribe(observer);
        });
    };
    RadixTransferAccountSystem.prototype.getUnspentConsumables = function () {
        return this.unspentConsumables;
    };
    return RadixTransferAccountSystem;
}());
exports.default = RadixTransferAccountSystem;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmFkaXhUcmFuc2ZlckFjY291bnRTeXN0ZW0uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbW9kdWxlcy9hY2NvdW50L1JhZGl4VHJhbnNmZXJBY2NvdW50U3lzdGVtLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDZCQUFxRTtBQUNyRSxpREFBc0M7QUFLdEMsZ0ZBQWlEO0FBRWpELGdFQUE4RDtBQUM5RCxxREFBbUQ7QUFDbkQsb0RBUzBCO0FBRTFCO0lBWUksb0NBQXFCLE9BQXFCO1FBQXJCLFlBQU8sR0FBUCxPQUFPLENBQWM7UUFYbkMsU0FBSSxHQUFHLFVBQVUsQ0FBQTtRQUVqQixpQkFBWSxHQUFvQyxJQUFJLHNCQUFLLEVBQUUsQ0FBQTtRQUMzRCxZQUFPLEdBQWtDLEVBQUUsQ0FBQTtRQUUzQyx1QkFBa0IsR0FBb0MsSUFBSSxjQUFPLEVBQUUsQ0FBQTtRQUdsRSx1QkFBa0IsR0FBaUMsSUFBSSxzQkFBSyxFQUFFLENBQUE7UUFDOUQscUJBQWdCLEdBQWlDLElBQUksc0JBQUssRUFBRSxDQUFBO1FBR2hFLHFDQUFxQztRQUNyQyxJQUFJLENBQUMsT0FBTyxDQUNSLHFDQUFpQixDQUFDLGFBQWEsQ0FBQyx5QkFBVyxDQUFDLFlBQVksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FDMUUsR0FBRyxDQUFDLENBQUE7UUFDTCxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksc0JBQWUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDM0QsQ0FBQztJQUVZLHNEQUFpQixHQUE5QixVQUErQixVQUEyQjs7OztnQkFDaEQsSUFBSSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUE7Z0JBQzVCLElBQUksSUFBSSxDQUFDLFVBQVUsS0FBSyxxQ0FBb0IsQ0FBQyxVQUFVLEVBQUU7b0JBQ3JELHNCQUFNO2lCQUNUO2dCQUVELElBQUksVUFBVSxDQUFDLE1BQU0sS0FBSyxPQUFPLEVBQUU7b0JB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