"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var rxjs_1 = require("rxjs");
var RadixFeeProvider_1 = tslib_1.__importDefault(require("../fees/RadixFeeProvider"));
var RadixUniverse_1 = require("../universe/RadixUniverse");
var __1 = require("../..");
var RadixAtomModel_1 = require("../RadixAtomModel");
var RadixTransactionBuilder = /** @class */ (function () {
    function RadixTransactionBuilder() {
        this.particles = [];
        this.action = 'STORE';
        this.operation = 'TRANSFER';
    }
    /**
     * Creates transfer atom
     * @param from Sender account, needs to have RadixAccountTransferSystem
     * @param to Receiver account
     * @param token The TokenClass or an ISO string name
     * @param decimalQuantity
     * @param [message] Optional reference message
     */
    RadixTransactionBuilder.createTransferAtom = function (from, to, token, decimalQuantity, message) {
        return new RadixTransactionBuilder().createTransferAtom(from, to, token, decimalQuantity, message);
    };
    /**
     * Creates transfer atom
     * @param from Sender account, needs to have RadixAccountTransferSystem
     * @param to Receiver account
     * @param token The TokenClass or an ISO string name
     * @param decimalQuantity
     * @param [message] Optional reference message
     */
    RadixTransactionBuilder.prototype.createTransferAtom = function (from, to, token, decimalQuantity, message) {
        var e_1, _a;
        this.type = 'TRANSFER';
        if (isNaN(decimalQuantity)) {
            throw new Error('Amount is not a valid number');
        }
        var tokenClass;
        if (typeof token === 'string') {
            tokenClass = __1.radixTokenManager.getTokenByISO(token);
        }
        else if (token instanceof RadixAtomModel_1.RadixTokenClass) {
            tokenClass = token;
        }
        else {
            throw new Error('Invalid token supplied');
        }
        var quantity = tokenClass.toSubunits(decimalQuantity);
        if (quantity < 0) {
            throw new Error('Cannot send negative amount');
        }
        else if (quantity === 0 && decimalQuantity > 0) {
            var decimalPlaces = Math.log10(tokenClass.sub_units);
            throw new Error("You can only specify up to " + decimalPlaces + " decimal places");
        }
        else if (quantity === 0 && decimalQuantity === 0) {
            throw new Error("Cannot send 0");
        }
        var transferSytem = from.getSystem('TRANSFER');
        if (quantity > transferSytem.balance[tokenClass.id.toString()]) {
            throw new Error('Insufficient funds');
        }
        var particles = [];
        var unspentConsumables = transferSytem.getUnspentConsumables();
        var consumerQuantity = 0;
        try {
            for (var _b = tslib_1.__values(unspentConsumables.entries()), _c = _b.next(); !_c.done; _c = _b.next()) {
                var _d = tslib_1.__read(_c.value, 2), consumable = _d[1];
                if (consumable.asset_id.toString() !== tokenClass.id.toString()) {
                    continue;
                }
                var consumer = new RadixAtomModel_1.RadixConsumer(consumable);
                particles.push(consumer);
                consumerQuantity += consumer.quantity;
                if (consumerQuantity >= quantity) {
                    break;
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        // Create consumables
        var recipientConsumable = new RadixAtomModel_1.RadixConsumable();
        recipientConsumable.asset_id = tokenClass.id;
        recipientConsumable.quantity = quantity;
        // recipientConsumable.quantity = Long.fromNumber(quantity)
        recipientConsumable.destinations = [to.keyPair.getUID()];
        recipientConsumable.nonce = Date.now();
        recipientConsumable.owners = [
            RadixAtomModel_1.RadixECKeyPair.fromRadixKeyPair(to.keyPair)
        ];
        particles.push(recipientConsumable);
        // Transfer reminder back to self
        if (consumerQuantity - quantity > 0) {
            var reminderConsumable = new RadixAtomModel_1.RadixConsumable();
            reminderConsumable.asset_id = tokenClass.id;
            reminderConsumable.quantity = consumerQuantity - quantity;
            reminderConsumable.destinations = [from.keyPair.getUID()];
            reminderConsumable.nonce = Date.now();
            reminderConsumable.owners = [
                RadixAtomModel_1.RadixECKeyPair.fromRadixKeyPair(from.keyPair)
            ];
            particles.push(reminderConsumable);
        }
        this.action = 'STORE';
        this.operation = 'TRANSFER';
        this.particles = particles;
        this.recipients = [from, to];
        if (message) {
            this.payload = message;
        }
        return this;
    };
    /**
     * Creates payload atom
     * @param from
     * @param to
     * @param applicationId
     * @param payload
     * @param [encrypted] Sets if the message should be encrypted using ECIES
     */
    RadixTransactionBuilder.createPayloadAtom = function (readers, applicationId, payload, encrypted) {
        if (encrypted === void 0) { encrypted = true; }
        return new RadixTransactionBuilder().createPayloadAtom(readers, applicationId, payload, encrypted);
    };
    /**
     * Creates payload atom
     * @param from
     * @param to
     * @param applicationId
     * @param payload
     * @param [encrypted] Sets if the message should be encrypted using ECIES
     */
    RadixTransactionBuilder.prototype.createPayloadAtom = function (readers, applicationId, payload, encrypted) {
        var e_2, _a;
        if (encrypted === void 0) { encrypted = true; }
        this.type = 'PAYLOAD';
        var recipients = [];
        try {
            for (var readers_1 = tslib_1.__values(readers), readers_1_1 = readers_1.next(); !readers_1_1.done; readers_1_1 = readers_1.next()) {
                var account = readers_1_1.value;
                recipients.push(account);
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (readers_1_1 && !readers_1_1.done && (_a = readers_1.return)) _a.call(readers_1);
            }
            finally { if (e_2) throw e_2.error; }
        }
        this.recipients = recipients;
        this.applicationId = applicationId;
        this.payload = payload;
        this.encrypted = encrypted;
        return this;
    };
    /**
     * Creates radix messaging application payload atom
     * @param from
     * @param to
     * @param message
     */
    RadixTransactionBuilder.createRadixMessageAtom = function (from, to, message) {
        return new RadixTransactionBuilder().createRadixMessageAtom(from, to, message);
    };
    /**
     * Creates radix messaging application payload atom
     * @param from
     * @param to
     * @param message
     */
    RadixTransactionBuilder.prototype.createRadixMessageAtom = function (from, to, message) {
        this.type = 'PAYLOAD';
        var recipients = [];
        recipients.push(from);
        recipients.push(to);
        var payload = JSON.stringify({
            to: to.getAddress(),
            from: from.getAddress(),
            content: message,
        });
        this.recipients = recipients;
        this.applicationId = 'radix-messaging';
        this.payload = payload;
        this.encrypted = true;
        return this;
    };
    /**
     * Builds the atom, finds a node to submit to, adds network fee, signs the atom and submits
     * @param signer
     * @returns a BehaviourSubject that streams the atom status updates
     */
    RadixTransactionBuilder.prototype.signAndSubmit = function (signer) {
        var _this = this;
        var atom = null;
        if (this.type === 'TRANSFER') {
            atom = new RadixAtomModel_1.RadixTransactionAtom();
            atom.action = this.action;
            atom.operation = this.operation;
            atom.particles = this.particles;
            atom.destinations = this.recipients.map(function (account) { return account.keyPair.getUID(); });
            atom.timestamps = { default: Date.now() };
            if (this.payload) {
                atom.addEncryptedPayload(this.payload, this.recipients.map(function (account) { return account.keyPair; }));
            }
        }
        else if (this.type === 'PAYLOAD') {
            atom = RadixAtomModel_1.RadixApplicationPayloadAtom.withEncryptedPayload(this.payload, this.recipients.map(function (account) { return account.keyPair; }), this.applicationId, this.encrypted);
            atom.particles = this.particles;
        }
        else {
            throw new Error('Atom details have not been specified, call one of the builder methods first');
        }
        // Find a shard, any of the participant shards is ok
        var shard = this.recipients[0].keyPair.getShard();
        // Get node from universe
        var nodeConnection = null;
        var stateSubject = new rxjs_1.BehaviorSubject('FINDING_NODE');
        var signedAtom = null;
        RadixUniverse_1.radixUniverse
            .getNodeConnection(shard)
            .then(function (connection) {
            nodeConnection = connection;
            // Add POW fee
            stateSubject.next('GENERATING_POW');
            return RadixFeeProvider_1.default.generatePOWFee(RadixUniverse_1.radixUniverse.universeConfig.getMagic(), __1.radixTokenManager.getTokenByISO('POW'), atom, nodeConnection);
        })
            .then(function (powFeeConsumable) {
            atom.particles.push(powFeeConsumable);
            // Sing atom
            stateSubject.next('SIGNING');
            return signer.signAtom(atom);
        })
            .then(function (_signedAtom) {
            var e_3, _a;
            signedAtom = _signedAtom;
            try {
                // Push atom into recipient accounts to minimize delay
                for (var _b = tslib_1.__values(_this.recipients), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var recipient = _c.value;
                    recipient._onAtomReceived({
                        action: 'STORE',
                        atom: signedAtom,
                    });
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_3) throw e_3.error; }
            }
            var submissionSbuject = nodeConnection.submitAtom(signedAtom);
            submissionSbuject.subscribe(stateSubject);
            submissionSbuject.subscribe({ error: function (error) {
                    var e_4, _a;
                    try {
                        // Delete atom from recipient accounts
                        for (var _b = tslib_1.__values(_this.recipients), _c = _b.next(); !_c.done; _c = _b.next()) {
                            var recipient = _c.value;
                            recipient._onAtomReceived({
                                action: 'DELETE',
                                atom: signedAtom,
                            });
                        }
                    }
                    catch (e_4_1) { e_4 = { error: e_4_1 }; }
                    finally {
                        try {
                            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                        }
                        finally { if (e_4) throw e_4.error; }
                    }
                } });
        })
            .catch(function (error) {
            stateSubject.error(error);
        });
        return stateSubject;
    };
    return RadixTransactionBuilder;
}());
exports.default = RadixTransactionBuilder;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmFkaXhUcmFuc2FjdGlvbkJ1aWxkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbW9kdWxlcy90eGJ1aWxkZXIvUmFkaXhUcmFuc2FjdGlvbkJ1aWxkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkJBQXNDO0FBS3RDLHNGQUF1RDtBQUV2RCwyREFBeUQ7QUFDekQsMkJBQXlDO0FBRXpDLG9EQVUwQjtBQUUxQjtJQVVJO1FBTlEsY0FBUyxHQUFvQixFQUFFLENBQUE7UUFDL0IsV0FBTSxHQUFHLE9BQU8sQ0FBQTtRQUNoQixjQUFTLEdBQUcsVUFBVSxDQUFBO0lBSWYsQ0FBQztJQUdoQjs7Ozs7OztPQU9HO0lBQ1csMENBQWtCLEdBQWhDLFVBQ0ksSUFBa0IsRUFDbEIsRUFBZ0IsRUFDaEIsS0FBK0IsRUFDL0IsZUFBdUIsRUFDdkIsT0FBZ0I7UUFFaEIsT0FBTyxJQUFJLHVCQUF1QixFQUFFLENBQUMsa0JBQWtCLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUFFLE9BQU8sQ0FBQyxDQUFBO0lBQ3RHLENBQUM7SUFHRDs7Ozs7OztPQU9HO0lBQ0ksb0RBQWtCLEdBQXpCLFVBQ0ksSUFBa0IsRUFDbEIsRUFBZ0IsRUFDaEIsS0FBK0IsRUFDL0IsZUFBdUIsRUFDdkIsT0FBZ0I7O1FBRWhCLElBQUksQ0FBQyxJQUFJLEdBQUcsVUFBVSxDQUFBO1FBRXRCLElBQUksS0FBSyxDQUFDLGVBQWUsQ0FBQyxFQUFFO1lBQ3hCLE1BQU0sSUFBSSxLQUFLLENBQUMsOEJBQThCLENBQUMsQ0FBQTtTQUNsRDtRQUVELElBQUksVUFBVSxDQUFBO1FBQ2QsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7WUFDM0IsVUFBVSxHQUFHLHFCQUFpQixDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQTtTQUN0RDthQUFNLElBQUksS0FBSyxZQUFZLGdDQUFlLEVBQUU7WUFDekMs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