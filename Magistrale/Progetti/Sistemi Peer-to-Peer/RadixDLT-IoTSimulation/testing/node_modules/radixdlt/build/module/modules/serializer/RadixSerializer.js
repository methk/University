import { TSMap } from 'typescript-map';
import { RadixApplicationPayloadAtom, RadixBasicPayloadAtom, RadixConsumable, RadixConsumer, RadixECKeyPair, RadixEmission, RadixNullAtom, RadixNullJunk, RadixSignature, RadixTransactionAtom, RadixBase64, RadixEUID, RadixHash, RadixEncryptor, RadixAtomFeeConsumable, RadixFeeConsumable, RadixTokenClass } from '../RadixAtomModel';
import { logger } from '../common/RadixLogger';
import Long from 'long';
export var DataTypes;
(function (DataTypes) {
    DataTypes[DataTypes["BOOLEAN"] = 1] = "BOOLEAN";
    DataTypes[DataTypes["NUMBER"] = 2] = "NUMBER";
    DataTypes[DataTypes["STRING"] = 3] = "STRING";
    DataTypes[DataTypes["BYTES"] = 4] = "BYTES";
    DataTypes[DataTypes["OBJECT"] = 5] = "OBJECT";
    DataTypes[DataTypes["ARRAY"] = 6] = "ARRAY";
    DataTypes[DataTypes["EUID"] = 7] = "EUID";
    DataTypes[DataTypes["HASH"] = 8] = "HASH";
})(DataTypes || (DataTypes = {}));
export default class RadixSerializer {
    static fromJson(json) {
        if (Array.isArray(json)) {
            let output = [];
            for (let item of json) {
                output.push(RadixSerializer.fromJson(item));
            }
            return output;
        }
        else if (typeof json === 'object') {
            return RadixSerializer.fromJsonObject(json);
        }
        else {
            return json;
        }
    }
    static fromJsonObject(jsonObject) {
        let output = {};
        for (let key in jsonObject) {
            output[key] = RadixSerializer.fromJson(jsonObject[key]);
        }
        if ('serializer' in output) {
            let type = output['serializer'];
            switch (type) {
                case RadixEUID.SERIALIZER:
                    return RadixEUID.fromJson(output);
                case RadixHash.SERIALIZER:
                    return RadixHash.fromJson(output);
                case RadixBase64.SERIALIZER:
                    return RadixBase64.fromJson(output);
                case RadixNullAtom.SERIALIZER:
                    return new RadixNullAtom(output);
                case RadixNullJunk.SERIALIZER:
                    return new RadixNullJunk(output);
                case RadixSignature.SERIALIZER:
                    return new RadixSignature(output);
                case RadixBasicPayloadAtom.SERIALIZER:
                    return new RadixBasicPayloadAtom(output);
                case RadixApplicationPayloadAtom.SERIALIZER:
                    return new RadixApplicationPayloadAtom(output);
                case RadixECKeyPair.SERIALIZER:
                    return new RadixECKeyPair(output);
                case RadixEncryptor.SERIALIZER:
                    return new RadixEncryptor(output);
                case RadixTransactionAtom.SERIALIZER:
                    return new RadixTransactionAtom(output);
                case RadixEmission.SERIALIZER:
                    return new RadixEmission(output);
                case RadixConsumable.SERIALIZER:
                    return new RadixConsumable(output);
                case RadixConsumer.SERIALIZER:
                    return new RadixConsumer(output);
                case RadixTokenClass.SERIALIZER:
                    return new RadixTokenClass(output);
                case RadixFeeConsumable.SERIALIZER:
                    return new RadixFeeConsumable(output);
                case RadixAtomFeeConsumable.SERIALIZER:
                    return new RadixAtomFeeConsumable(output);
                default:
                    logger.trace(`Serializer "${type}" not implemented`);
                    break;
            }
        }
        return output;
    }
    static toJson(data) {
        if (Array.isArray(data)) {
            let output = [];
            for (let item of data) {
                output.push(RadixSerializer.toJson(item));
            }
            return output;
        }
        else if (typeof data === 'string' ||
            typeof data === 'number' ||
            typeof data === 'boolean' ||
            data instanceof Long) {
            return data;
        }
        else if (data !== null && typeof data === 'object') {
            if (typeof data.toJson === 'function') {
                return data.toJson();
            }
            else {
                let output = {};
                for (let key in data) {
                    let serialized = RadixSerializer.toJson(data[key]);
                    if (serialized) {
                        output[key] = serialized;
                    }
                }
                return output;
            }
        }
    }
    static fromByteArray(bytes) {
        // Read 1 byte for type
        let type = bytes.readUInt8(0);
        // Read 4 bytes for length
        let length = bytes.readUInt32BE(1);
        // Switch on type
        switch (type) {
            case DataTypes.BOOLEAN: {
                return bytes.readUInt8(5) ? true : false;
            }
            case DataTypes.NUMBER: {
                return Long.fromBytesBE([...bytes.slice(5, 13)]).toNumber();
            }
            case DataTypes.STRING: {
                return bytes.slice(5, 5 + length).toString('utf8');
            }
            case DataTypes.BYTES: {
                return new RadixBase64(bytes.slice(5, 5 + length));
            }
            case DataTypes.OBJECT: {
                return this.fromObjectByteArray(bytes);
            }
            case DataTypes.ARRAY: {
                let output = [];
                let offset = 5;
                while (offset < length) {
                    // Read 2nd to 5th bytes to find out the length of the value
                    let valueLength = bytes.readUInt32BE(offset + 1);
                    output.push(this.fromByteArray(bytes.slice(offset, offset + 5 + valueLength)));
                    offset += 5 + valueLength;
                }
                return output;
            }
            case DataTypes.EUID: {
                return new RadixEUID(bytes.slice(5, 5 + length));
            }
            case DataTypes.HASH: {
                return new RadixHash(bytes.slice(5, 5 + length));
            }
        }
    }
    static fromObjectByteArray(bytes) {
        // Read 4 bytes for length
        let length = bytes.readUInt32BE(1);
        let offset = 5;
        let output = {};
        while (offset < length + 5) {
            let keyLength = bytes.readUInt8(offset);
            offset++;
            let key = bytes.slice(offset, offset + keyLength).toString('utf8');
            offset += keyLength;
            // Read 2nd to 5th bytes to find out the length of the value
            let valueLength = bytes.readUInt32BE(offset + 1);
            output[key] = this.fromByteArray(bytes.slice(offset, offset + 5 + valueLength));
            offset += 5 + valueLength;
        }
        // Check if has serializer, cast
        if ('serializer' in output) {
            let type = output['serializer'];
            switch (type) {
                case RadixNullAtom.SERIALIZER:
                    return new RadixNullAtom(output);
                case RadixNullJunk.SERIALIZER:
                    return new RadixNullJunk(output);
                case RadixSignature.SERIALIZER:
                    return new RadixSignature(output);
                case RadixBasicPayloadAtom.SERIALIZER:
                    return new RadixBasicPayloadAtom(output);
                case RadixECKeyPair.SERIALIZER:
                    return new RadixECKeyPair(output);
                case RadixEncryptor.SERIALIZER:
                    return new RadixEncryptor(output);
                default:
                    logger.trace(`Serializer "${type}" not implemented`);
                    break;
            }
        }
        return output;
    }
    static toByteArray(data) {
        let output = new Buffer([]);
        if (Array.isArray(data)) {
            let type = DataTypes.ARRAY;
            let length = 0;
            // Serialize all items
            let serialized = [];
            for (let item of data) {
                let serializedItem = this.toByteArray(item);
                length += serializedItem.length;
                serialized.push(serializedItem);
            }
            // Write everything to the buffer
            output = Buffer.alloc(length + 5);
            output.writeUInt8(type, 0);
            output.writeUInt32BE(length, 1);
            let position = 5;
            for (let item of serialized) {
                item.copy(output, position);
                position += item.length;
            }
        }
        else if (typeof data === 'number' || data instanceof Long) {
            let type = DataTypes.NUMBER;
            let length = 8;
            let bufferData = (data instanceof Long) ? Buffer.from(data.toBytes()) : Buffer.from(Long.fromNumber(data).toBytes());
            output = Buffer.alloc(length + 5);
            output.writeUInt8(type, 0);
            output.writeUInt32BE(length, 1);
            bufferData.copy(output, 5);
        }
        else if (typeof data === 'object') {
            if (typeof data.toByteArray === 'function') {
                // Radix objects
                output = data.toByteArray();
            }
            else {
                // Generic object
                let type = DataTypes.OBJECT;
                let length = 0;
                // Serialize all properties
                // Build a map sorted by property name
                let map = new TSMap();
                for (let key in data) {
                    let serializedValue = this.toByteArray(data[key]);
                    length += key.length + 1 + serializedValue.length;
                    map.sortedSet(key, serializedValue);
                }
                // Write everything to the buffer
                output = Buffer.alloc(length + 5);
                output.writeUInt8(type, 0);
                output.writeUInt32BE(length, 1);
                let position = 5;
                for (let key of map.keys()) {
                    let value = map.get(key);
                    output.writeUInt8(key.length, position);
                    position++;
                    output.write(key, position);
                    position += key.length;
                    value.copy(output, position);
                    position += value.length;
                }
            }
        }
        else if (typeof data === 'boolean') {
            let type = DataTypes.BOOLEAN;
            let length = 1;
            output = Buffer.alloc(length + 5);
            output.writeUInt8(type, 0);
            output.writeUInt32BE(length, 1);
            output.writeUInt8(data ? 1 : 0, 5);
        }
        else if (typeof data === 'string') {
            let type = DataTypes.STRING;
            let bufferData = Buffer.from(data, 'utf8');
            let length = bufferData.length;
            output = Buffer.alloc(length + 5);
            output.writeUInt8(type, 0);
            output.writeUInt32BE(length, 1);
            bufferData.copy(output, 5);
        }
        else if (typeof data === 'function') {
            // Ignore
        }
        else {
            logger.trace('Unknown type', data);
        }
        return output;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmFkaXhTZXJpYWxpemVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL21vZHVsZXMvc2VyaWFsaXplci9SYWRpeFNlcmlhbGl6ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBRXRDLE9BQU8sRUFDSCwyQkFBMkIsRUFDM0IscUJBQXFCLEVBQ3JCLGVBQWUsRUFDZixhQUFhLEVBQ2IsY0FBYyxFQUNkLGFBQWEsRUFDYixhQUFhLEVBQ2IsYUFBYSxFQUNiLGNBQWMsRUFDZCxvQkFBb0IsRUFDcEIsV0FBVyxFQUNYLFNBQVMsRUFDVCxTQUFTLEVBQ1QsY0FBYyxFQUNkLHNCQUFzQixFQUN0QixrQkFBa0IsRUFDbEIsZUFBZSxFQUNsQixNQUFNLG1CQUFtQixDQUFBO0FBRTFCLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQTtBQUU5QyxPQUFPLElBQUksTUFBTSxNQUFNLENBQUE7QUFFdkIsTUFBTSxDQUFOLElBQVksU0FTWDtBQVRELFdBQVksU0FBUztJQUNqQiwrQ0FBVyxDQUFBO0lBQ1gsNkNBQVUsQ0FBQTtJQUNWLDZDQUFVLENBQUE7SUFDViwyQ0FBUyxDQUFBO0lBQ1QsNkNBQVUsQ0FBQTtJQUNWLDJDQUFTLENBQUE7SUFDVCx5Q0FBUSxDQUFBO0lBQ1IseUNBQVEsQ0FBQTtBQUNaLENBQUMsRUFUVyxTQUFTLEtBQVQsU0FBUyxRQVNwQjtBQUVELE1BQU0sQ0FBQyxPQUFPLE9BQU8sZUFBZTtJQUN6QixNQUFNLENBQUMsUUFBUSxDQUFDLElBQVM7UUFDNUIsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3JCLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQTtZQUNmLEtBQUssSUFBSSxJQUFJLElBQUksSUFBSSxFQUFFO2dCQUNuQixNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxR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