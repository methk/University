import RadixPOWTask from '../pow/RadixPOWTask';
import RadixUtil from '../common/RadixUtil';
import { RadixAtomFeeConsumable, RadixECKeyPair, RadixKeyPair } from '../RadixAtomModel';
export default class RadixFeeProvider {
    static async generatePOWFee(magic, token, atom, endorsee) {
        const endorseePublicKey = endorsee.node.system.key.data;
        // Compute difficulty, make a target buffer with first n bits set to 0
        const target = RadixUtil.powTargetFromAtomSize(atom.getSize());
        // Make seed
        const seed = atom.getHash();
        // POW
        const powTask = new RadixPOWTask(magic, seed, target);
        const pow = await powTask.computePow();
        // Make AtomFeeConsumable
        const feeConsumable = new RadixAtomFeeConsumable();
        // Token
        feeConsumable.asset_id = token.id;
        feeConsumable.quantity = pow.nonce.toNumber();
        feeConsumable.nonce = Date.now();
        feeConsumable.owners = [
            RadixECKeyPair.fromRadixKeyPair(RadixKeyPair.fromPublic(endorseePublicKey))
        ];
        return feeConsumable;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmFkaXhGZWVQcm92aWRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9tb2R1bGVzL2ZlZXMvUmFkaXhGZWVQcm92aWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLFlBQVksTUFBTSxxQkFBcUIsQ0FBQTtBQUM5QyxPQUFPLFNBQVMsTUFBTSxxQkFBcUIsQ0FBQTtBQUUzQyxPQUFPLEVBRUgsc0JBQXNCLEVBQ3RCLGNBQWMsRUFDZCxZQUFZLEVBRWYsTUFBTSxtQkFBbUIsQ0FBQTtBQUUxQixNQUFNLENBQUMsT0FBTyxPQUFPLGdCQUFnQjtJQUMxQixNQUFNLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FDOUIsS0FBYSxFQUNiLEtBQXNCLEVBQ3RCLElBQWUsRUFDZixRQUE2QjtRQUU3QixNQUFNLGlCQUFpQixHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUE7UUFFdkQsc0VBQXNFO1FBQ3RFLE1BQU0sTUFBTSxHQUFHLFNBQVMsQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQTtRQUU5RCxZQUFZO1FBQ1osTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFBO1FBRTNCLE1BQU07UUFDTixNQUFNLE9BQU8sR0FBRyxJQUFJLFlBQVksQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQ3JELE1BQU0sR0FBRyxHQUFHLE1BQU0sT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFBO1FBRXRDLHlCQUF5QjtRQUN6QixNQUFNLGFBQWEsR0FBRyxJQUFJLHNCQUFzQixFQUFFLENBQUE7UUFFbEQsUUFBUTtRQUNSLGFBQWEsQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDLEVBQUUsQ0FBQTtRQUNqQyxhQUFhLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUE7UUFDN0MsYUFBYSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUE7UUFDaEMsYUFBYSxDQUFDLE1BQU0sR0FBRztZQUNuQixjQUFjLENBQUMsZ0JBQWdCLENBQzNCLFlBQVksQ0FBQyxVQUFVLENBQUMsaUJBQWlCLENBQUMsQ0FDN0M7U0FDSixDQUFBO1FBRUQsT0FBTyxhQUFhLENBQUE7SUFDeEIsQ0FBQztDQUNKIn0=