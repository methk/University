import RadixUniverseConfig from './RadixUniverseConfig';
import RadixNodeDiscoveryFromNodeFinder from './RadixNodeDiscoveryFromNodeFinder';
import RadixNodeDiscoveryFromSeed from './RadixNodeDiscoveryFromSeed';
import RadixNodeConnection from './RadixNodeConnection';
import RadixUtil from '../common/RadixUtil';
import { radixTokenManager } from '../token/RadixTokenManager';
import { logger } from '../common/RadixLogger';
import Long from 'long';
import promiseRetry from 'promise-retry';
import ipaddr from 'ipaddr.js';
export default class RadixUniverse {
    constructor() {
        this.initialized = false;
        this.liveNodes = [];
        this.connectedNodes = [];
        this.lastNetworkUpdate = 0;
        this.networkUpdateInterval = 1000 * 60 * 10;
        /**
         * Close all open connections
         * Recommended to call this before quitting the application, so that nodes can close the corresponding open connections as well
         */
        this.closeAllConnections = () => {
            for (const connection of this.connectedNodes) {
                connection.close();
            }
        };
    }
    /**
     * Bootstraps the universe with a specific configuration
     * Must be called before performing any operations
     * Use one of the predefined static configurations in this class
     * @param config
     */
    bootstrap(config) {
        this.universeConfig = config.universeConfig;
        this.nodeDiscovery = config.nodeDiscovery;
        this.nodeRPCAddress = config.nodeRPCAddress;
        this.initialized = true;
        radixTokenManager.initialize();
    }
    /**
     * Given an IP address this function resolves a deterministic
     * DNS record in the radixnode.net domain.
     *
     * @param address IP address or hostname
     */
    static resolveNodeName(address) {
        try {
            const ipbytes = ipaddr.parse(address).toByteArray();
            if (ipbytes.length == 4) { // IPv4
                // trivial but safe left-shift function that does not overflow
                const shl = (base, exp) => base * Math.pow(2, exp);
                // use + instead of | (bitwise or) because it overflows
                let ip = ipbytes[3] + shl(ipbytes[2], 8) + shl(ipbytes[1], 16) + shl(ipbytes[0], 24);
                return `a${ip.toString(36)}.radixnode.net`;
            }
            logger.warn('No base36 encoder for IPv6 yet');
            return `[${address}]`;
        }
        catch (err) {
            // the address has neither IPv6 nor IPv4 format => hostname
        }
        return address;
    }
    /**
     * Gets the universe magic byte, used mainly for generating an address from a public key
     * @returns
     */
    getMagicByte() {
        return this.universeConfig.getMagicByte();
    }
    loadPeersFromBootstrap() {
        return promiseRetry(async (retry, attempt) => {
            try {
                this.liveNodes = await this.nodeDiscovery.loadNodes();
                this.lastNetworkUpdate = Date.now();
                return this.liveNodes;
            }
            catch (error) {
                logger.error(error);
                retry();
            }
        }, {
            retries: 1000,
            maxtimeout: 60000
        });
    }
    /**
     * Gets a RadixNodeConnection for a specified shard
     * Updates the node list if neccessary
     * @param shard
     * @returns node connection
     */
    getNodeConnection(shard) {
        return new Promise((resolve, reject) => {
            // Find active connection, return
            for (const node of this.connectedNodes) {
                if (node.isReady() && this.canNodeServiceShard(node.node, shard)) {
                    logger.info('Got an active connection');
                    return resolve(node);
                }
            }
            // Failing that, find a pending node connection
            for (const node of this.connectedNodes) {
                if (this.canNodeServiceShard(node.node, shard)) {
                    logger.info('Got a pending connection');
                    // Wait for ready or error
                    node.on('open', () => {
                        resolve(node);
                    });
                    node.on('closed', () => {
                        resolve(this.getNodeConnection(shard));
                    });
                    return;
                }
            }
            // Open a new connection, return when ready
            logger.info('Opening a new connection');
            this.openNodeConnection(shard).then((connection) => {
                if (connection) {
                    resolve(connection);
                }
                else {
                    reject(`Coudln't find a node to connect to`);
                }
            });
        });
    }
    async openNodeConnection(shard) {
        if (Date.now() - this.lastNetworkUpdate > this.networkUpdateInterval) {
            await this.loadPeersFromBootstrap();
        }
        // Randomize node order every time
        this.liveNodes = RadixUtil.shuffleArray(this.liveNodes);
        for (const node of this.liveNodes) {
            if (this.canNodeServiceShard(node, shard)) {
                const connection = new RadixNodeConnection(node, this.nodeRPCAddress);
                this.connectedNodes.push(connection);
                connection.on('closed', () => {
                    // Remove connection from connected nodes 
                    const nodeIndex = this.connectedNodes.indexOf(connection);
                    if (nodeIndex > -1) {
                        this.connectedNodes.splice(nodeIndex, 1);
                    }
                });
                try {
                    await connection.openConnection();
                }
                catch (error) {
                    logger.error(error);
                    return null;
                }
                return connection;
            }
        }
        return null;
    }
    canNodeServiceShard(node, shard) {
        if (node.system) {
            const low = Long.fromValue(node.system.shards.low);
            const high = Long.fromValue(node.system.shards.high);
            if (high.lessThan(low)) {
                // Wrap around
                return (shard.greaterThanOrEqual(low) || shard.lessThanOrEqual(high));
            }
            else {
                return (shard.greaterThanOrEqual(low) && shard.lessThanOrEqual(high));
            }
        }
        return false;
    }
}
RadixUniverse.ALPHANET = {
    universeConfig: RadixUniverseConfig.ALPHANET,
    nodeDiscovery: new RadixNodeDiscoveryFromNodeFinder('https://alphanet.radixdlt.com/node-finder', nodeIp => `https://alphanet.radixdlt.com/node/${nodeIp}/rpc`),
    nodeRPCAddress: nodeIp => `wss://alphanet.radixdlt.com/node/${nodeIp}/rpc`,
};
RadixUniverse.ALPHANET2 = {
    universeConfig: RadixUniverseConfig.ALPHANET2,
    nodeDiscovery: new RadixNodeDiscoveryFromNodeFinder('https://alphanet2.radixdlt.com/node-finder', nodeIp => `https://${RadixUniverse.resolveNodeName(nodeIp)}/rpc`),
    nodeRPCAddress: nodeIp => `wss://${RadixUniverse.resolveNodeName(nodeIp)}/rpc`,
};
RadixUniverse.HIGHGARDEN = {
    universeConfig: RadixUniverseConfig.HIGHGARDEN,
    nodeDiscovery: new RadixNodeDiscoveryFromNodeFinder('https://highgarden.radixdlt.com/node-finder', nodeIp => `https://highgarden.radixdlt.com/node/${nodeIp}/rpc`),
    nodeRPCAddress: nodeIp => `wss://highgarden.radixdlt.com/node/${nodeIp}/rpc`,
};
RadixUniverse.SUNSTONE = {
    universeConfig: RadixUniverseConfig.SUNSTONE,
    nodeDiscovery: new RadixNodeDiscoveryFromNodeFinder('https://sunstone.radixdlt.com/node-finder', nodeIp => `https://${nodeIp}/rpc`),
    nodeRPCAddress: nodeIp => `wss://${nodeIp}:443/rpc`,
};
RadixUniverse.WINTERFELL = {
    universeConfig: RadixUniverseConfig.WINTERFELL,
    nodeDiscovery: new RadixNodeDiscoveryFromSeed('http://52.190.0.18:8080/rpc'),
    nodeRPCAddress: nodeIp => `ws://${nodeIp}:8080/rpc`,
};
RadixUniverse.WINTERFELL_LOCAL = {
    universeConfig: RadixUniverseConfig.WINTERFELL_LOCAL,
    nodeDiscovery: new RadixNodeDiscoveryFromSeed('http://localhost:8080/rpc'),
    nodeRPCAddress: nodeIp => `ws://127.0.0.1:8080/rpc`,
};
export const radixUniverse = new RadixUniverse();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmFkaXhVbml2ZXJzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9tb2R1bGVzL3VuaXZlcnNlL1JhZGl4VW5pdmVyc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxtQkFBbUIsTUFBTSx1QkFBdUIsQ0FBQTtBQUV2RCxPQUFPLGdDQUFnQyxNQUFNLG9DQUFvQyxDQUFBO0FBQ2pGLE9BQU8sMEJBQTBCLE1BQU0sOEJBQThCLENBQUE7QUFFckUsT0FBTyxtQkFBbUIsTUFBTSx1QkFBdUIsQ0FBQTtBQUN2RCxPQUFPLFNBQVMsTUFBTSxxQkFBcUIsQ0FBQTtBQUczQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQTtBQUM5RCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sdUJBQXVCLENBQUE7QUFFOUMsT0FBTyxJQUFJLE1BQU0sTUFBTSxDQUFBO0FBQ3ZCLE9BQU8sWUFBWSxNQUFNLGVBQWUsQ0FBQTtBQUN4QyxPQUFPLE1BQU0sTUFBTSxXQUFXLENBQUM7QUFFL0IsTUFBTSxDQUFDLE9BQU8sT0FBTyxhQUFhO0lBQWxDO1FBNENXLGdCQUFXLEdBQUcsS0FBSyxDQUFBO1FBS2xCLGNBQVMsR0FBZ0IsRUFBRSxDQUFBO1FBQzNCLG1CQUFjLEdBQTBCLEVBQUUsQ0FBQTtRQUMxQyxzQkFBaUIsR0FBRyxDQUFDLENBQUE7UUFDckIsMEJBQXFCLEdBQUcsSUFBSSxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUE7UUEwSjlDOzs7V0FHRztRQUNJLHdCQUFtQixHQUFHLEdBQUcsRUFBRTtZQUM5QixLQUFLLE1BQU0sVUFBVSxJQUFJLElBQUksQ0FBQyxjQUFjLEVBQUU7Z0JBQzFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQTthQUNyQjtRQUNMLENBQUMsQ0FBQTtJQXFCTCxDQUFDO0lBckxHOzs7OztPQUtHO0lBQ0ksU0FBUyxDQUFDLE1BSWhCO1FBQ0csSUFBSSxDQUFDLGNBQWMsR0FB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