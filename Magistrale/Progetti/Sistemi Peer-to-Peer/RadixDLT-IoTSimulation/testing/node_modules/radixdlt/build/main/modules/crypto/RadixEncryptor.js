"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var RadixECIES_1 = tslib_1.__importDefault(require("./RadixECIES"));
var RadixAtomModel_1 = require("../RadixAtomModel");
var RadixLogger_1 = require("../common/RadixLogger");
var RadixEncryptor = /** @class */ (function (_super) {
    tslib_1.__extends(RadixEncryptor, _super);
    function RadixEncryptor(json) {
        var _this = _super.call(this, json) || this;
        _this.serializationProperties.push('protectors');
        return _this;
    }
    RadixEncryptor.prototype.getKey = function (accessor) {
        var e_1, _a;
        try {
            for (var _b = tslib_1.__values(this.protectors), _c = _b.next(); !_c.done; _c = _b.next()) {
                var protector = _c.value;
                try {
                    var decryptedPrivateKey = RadixECIES_1.default.decrypt(accessor.keyPair.getPrivate(), protector.data);
                    return decryptedPrivateKey;
                }
                catch (error) {
                    RadixLogger_1.logger.error('Couldn\'t decrypt:', error);
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        throw new Error('Could not decrypt any protectors');
    };
    RadixEncryptor.prototype.decrypt = function (data, accessor) {
        var privateKey = this.getKey(accessor);
        return RadixECIES_1.default.decrypt(privateKey, data.data);
    };
    RadixEncryptor.SERIALIZER = 105401064;
    return RadixEncryptor;
}(RadixAtomModel_1.RadixBasicContainer));
exports.default = RadixEncryptor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmFkaXhFbmNyeXB0b3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbW9kdWxlcy9jcnlwdG8vUmFkaXhFbmNyeXB0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsb0VBQXFDO0FBRXJDLG9EQUFrRjtBQUNsRixxREFBOEM7QUFFOUM7SUFBNEMsMENBQW1CO0lBSzNELHdCQUFZLElBQWE7UUFBekIsWUFDSSxrQkFBTSxJQUFJLENBQUMsU0FHZDtRQURHLEtBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUE7O0lBQ25ELENBQUM7SUFFRCwrQkFBTSxHQUFOLFVBQU8sUUFBc0I7OztZQUN6QixLQUFzQixJQUFBLEtBQUEsaUJBQUEsSUFBSSxDQUFDLFVBQVUsQ0FBQSxnQkFBQSw0QkFBRTtnQkFBbEMsSUFBSSxTQUFTLFdBQUE7Z0JBQ2QsSUFBSTtvQkFDQSxJQUFJLG1CQUFtQixHQUFHLG9CQUFVLENBQUMsT0FBTyxDQUN4QyxRQUFRLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxFQUM3QixTQUFTLENBQUMsSUFBSSxDQUNqQixDQUFBO29CQUNELE9BQU8sbUJBQW1CLENBQUE7aUJBQzdCO2dCQUFDLE9BQU8sS0FBSyxFQUFFO29CQUNaLG9CQUFNLENBQUMsS0FBSyxDQUFDLG9CQUFvQixFQUFFLEtBQUssQ0FBQyxDQUFBO2lCQUM1QzthQUNKOzs7Ozs7Ozs7UUFFRCxNQUFNLElBQUksS0FBSyxDQUFDLGtDQUFrQyxDQUFDLENBQUE7SUFDdkQsQ0FBQztJQUVELGdDQUFPLEdBQVAsVUFBUSxJQUFpQixFQUFFLFFBQXNCO1FBQzdDLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUE7UUFFdEMsT0FBTyxvQkFBVSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ3BELENBQUM7SUE5Qk0seUJBQVUsR0FBRyxTQUFTLENBQUE7SUErQmpDLHFCQUFDO0NBQUEsQUFoQ0QsQ0FBNEMsb0NBQW1CLEdBZ0M5RDtrQkFoQ29CLGNBQWMifQ==