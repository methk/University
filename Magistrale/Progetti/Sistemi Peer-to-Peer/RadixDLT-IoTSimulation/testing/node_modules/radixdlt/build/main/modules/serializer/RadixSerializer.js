"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var typescript_map_1 = require("typescript-map");
var RadixAtomModel_1 = require("../RadixAtomModel");
var RadixLogger_1 = require("../common/RadixLogger");
var long_1 = tslib_1.__importDefault(require("long"));
var DataTypes;
(function (DataTypes) {
    DataTypes[DataTypes["BOOLEAN"] = 1] = "BOOLEAN";
    DataTypes[DataTypes["NUMBER"] = 2] = "NUMBER";
    DataTypes[DataTypes["STRING"] = 3] = "STRING";
    DataTypes[DataTypes["BYTES"] = 4] = "BYTES";
    DataTypes[DataTypes["OBJECT"] = 5] = "OBJECT";
    DataTypes[DataTypes["ARRAY"] = 6] = "ARRAY";
    DataTypes[DataTypes["EUID"] = 7] = "EUID";
    DataTypes[DataTypes["HASH"] = 8] = "HASH";
})(DataTypes = exports.DataTypes || (exports.DataTypes = {}));
var RadixSerializer = /** @class */ (function () {
    function RadixSerializer() {
    }
    RadixSerializer.fromJson = function (json) {
        var e_1, _a;
        if (Array.isArray(json)) {
            var output = [];
            try {
                for (var json_1 = tslib_1.__values(json), json_1_1 = json_1.next(); !json_1_1.done; json_1_1 = json_1.next()) {
                    var item = json_1_1.value;
                    output.push(RadixSerializer.fromJson(item));
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (json_1_1 && !json_1_1.done && (_a = json_1.return)) _a.call(json_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
            return output;
        }
        else if (typeof json === 'object') {
            return RadixSerializer.fromJsonObject(json);
        }
        else {
            return json;
        }
    };
    RadixSerializer.fromJsonObject = function (jsonObject) {
        var output = {};
        for (var key in jsonObject) {
            output[key] = RadixSerializer.fromJson(jsonObject[key]);
        }
        if ('serializer' in output) {
            var type = output['serializer'];
            switch (type) {
                case RadixAtomModel_1.RadixEUID.SERIALIZER:
                    return RadixAtomModel_1.RadixEUID.fromJson(output);
                case RadixAtomModel_1.RadixHash.SERIALIZER:
                    return RadixAtomModel_1.RadixHash.fromJson(output);
                case RadixAtomModel_1.RadixBase64.SERIALIZER:
                    return RadixAtomModel_1.RadixBase64.fromJson(output);
                case RadixAtomModel_1.RadixNullAtom.SERIALIZER:
                    return new RadixAtomModel_1.RadixNullAtom(output);
                case RadixAtomModel_1.RadixNullJunk.SERIALIZER:
                    return new RadixAtomModel_1.RadixNullJunk(output);
                case RadixAtomModel_1.RadixSignature.SERIALIZER:
                    return new RadixAtomModel_1.RadixSignature(output);
                case RadixAtomModel_1.RadixBasicPayloadAtom.SERIALIZER:
                    return new RadixAtomModel_1.RadixBasicPayloadAtom(output);
                case RadixAtomModel_1.RadixApplicationPayloadAtom.SERIALIZER:
                    return new RadixAtomModel_1.RadixApplicationPayloadAtom(output);
                case RadixAtomModel_1.RadixECKeyPair.SERIALIZER:
                    return new RadixAtomModel_1.RadixECKeyPair(output);
                case RadixAtomModel_1.RadixEncryptor.SERIALIZER:
                    return new RadixAtomModel_1.RadixEncryptor(output);
                case RadixAtomModel_1.RadixTransactionAtom.SERIALIZER:
                    return new RadixAtomModel_1.RadixTransactionAtom(output);
                case RadixAtomModel_1.RadixEmission.SERIALIZER:
                    return new RadixAtomModel_1.RadixEmission(output);
                case RadixAtomModel_1.RadixConsumable.SERIALIZER:
                    return new RadixAtomModel_1.RadixConsumable(output);
                case RadixAtomModel_1.RadixConsumer.SERIALIZER:
                    return new RadixAtomModel_1.RadixConsumer(output);
                case RadixAtomModel_1.RadixTokenClass.SERIALIZER:
                    return new RadixAtomModel_1.RadixTokenClass(output);
                case RadixAtomModel_1.RadixFeeConsumable.SERIALIZER:
                    return new RadixAtomModel_1.RadixFeeConsumable(output);
                case RadixAtomModel_1.RadixAtomFeeConsumable.SERIALIZER:
                    return new RadixAtomModel_1.RadixAtomFeeConsumable(output);
                default:
                    RadixLogger_1.logger.trace("Serializer \"" + type + "\" not implemented");
                    break;
            }
        }
        return output;
    };
    RadixSerializer.toJson = function (data) {
        var e_2, _a;
        if (Array.isArray(data)) {
            var output = [];
            try {
                for (var data_1 = tslib_1.__values(data), data_1_1 = data_1.next(); !data_1_1.done; data_1_1 = data_1.next()) {
                    var item = data_1_1.value;
                    output.push(RadixSerializer.toJson(item));
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (data_1_1 && !data_1_1.done && (_a = data_1.return)) _a.call(data_1);
                }
                finally { if (e_2) throw e_2.error; }
            }
            return output;
        }
        else if (typeof data === 'string' ||
            typeof data === 'number' ||
            typeof data === 'boolean' ||
            data instanceof long_1.default) {
            return data;
        }
        else if (data !== null && typeof data === 'object') {
            if (typeof data.toJson === 'function') {
                return data.toJson();
            }
            else {
                var output = {};
                for (var key in data) {
                    var serialized = RadixSerializer.toJson(data[key]);
                    if (serialized) {
                        output[key] = serialized;
                    }
                }
                return output;
            }
        }
    };
    RadixSerializer.fromByteArray = function (bytes) {
        // Read 1 byte for type
        var type = bytes.readUInt8(0);
        // Read 4 bytes for length
        var length = bytes.readUInt32BE(1);
        // Switch on type
        switch (type) {
            case DataTypes.BOOLEAN: {
                return bytes.readUInt8(5) ? true : false;
            }
            case DataTypes.NUMBER: {
                return long_1.default.fromBytesBE(tslib_1.__spread(bytes.slice(5, 13))).toNumber();
            }
            case DataTypes.STRING: {
                return bytes.slice(5, 5 + length).toString('utf8');
            }
            case DataTypes.BYTES: {
                return new RadixAtomModel_1.RadixBase64(bytes.slice(5, 5 + length));
            }
            case DataTypes.OBJECT: {
                return this.fromObjectByteArray(bytes);
            }
            case DataTypes.ARRAY: {
                var output = [];
                var offset = 5;
                while (offset < length) {
                    // Read 2nd to 5th bytes to find out the length of the value
                    var valueLength = bytes.readUInt32BE(offset + 1);
                    output.push(this.fromByteArray(bytes.slice(offset, offset + 5 + valueLength)));
                    offset += 5 + valueLength;
                }
                return output;
            }
            case DataTypes.EUID: {
                return new RadixAtomModel_1.RadixEUID(bytes.slice(5, 5 + length));
            }
            case DataTypes.HASH: {
                return new RadixAtomModel_1.RadixHash(bytes.slice(5, 5 + length));
            }
        }
    };
    RadixSerializer.fromObjectByteArray = function (bytes) {
        // Read 4 bytes for length
        var length = bytes.readUInt32BE(1);
        var offset = 5;
        var output = {};
        while (offset < length + 5) {
            var keyLength = bytes.readUInt8(offset);
            offset++;
            var key = bytes.slice(offset, offset + keyLength).toString('utf8');
            offset += keyLength;
            // Read 2nd to 5th bytes to find out the length of the value
            var valueLength = bytes.readUInt32BE(offset + 1);
            output[key] = this.fromByteArray(bytes.slice(offset, offset + 5 + valueLength));
            offset += 5 + valueLength;
        }
        // Check if has serializer, cast
        if ('serializer' in output) {
            var type = output['serializer'];
            switch (type) {
                case RadixAtomModel_1.RadixNullAtom.SERIALIZER:
                    return new RadixAtomModel_1.RadixNullAtom(output);
                case RadixAtomModel_1.RadixNullJunk.SERIALIZER:
                    return new RadixAtomModel_1.RadixNullJunk(output);
                case RadixAtomModel_1.RadixSignature.SERIALIZER:
                    return new RadixAtomModel_1.RadixSignature(output);
                case RadixAtomModel_1.RadixBasicPayloadAtom.SERIALIZER:
                    return new RadixAtomModel_1.RadixBasicPayloadAtom(output);
                case RadixAtomModel_1.RadixECKeyPair.SERIALIZER:
                    return new RadixAtomModel_1.RadixECKeyPair(output);
                case RadixAtomModel_1.RadixEncryptor.SERIALIZER:
                    return new RadixAtomModel_1.RadixEncryptor(output);
                default:
                    RadixLogger_1.logger.trace("Serializer \"" + type + "\" not implemented");
                    break;
            }
        }
        return output;
    };
    RadixSerializer.toByteArray = function (data) {
        var e_3, _a, e_4, _b, e_5, _c;
        var output = new Buffer([]);
        if (Array.isArray(data)) {
            var type = DataTypes.ARRAY;
            var length_1 = 0;
            // Serialize all items
            var serialized = [];
            try {
                for (var data_2 = tslib_1.__values(data), data_2_1 = data_2.next(); !data_2_1.done; data_2_1 = data_2.next()) {
                    var item = data_2_1.value;
                    var serializedItem = this.toByteArray(item);
                    length_1 += serializedItem.length;
                    serialized.push(serializedItem);
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (data_2_1 && !data_2_1.done && (_a = data_2.return)) _a.call(data_2);
                }
                finally { if (e_3) throw e_3.error; }
            }
            // Write everything to the buffer
            output = Buffer.alloc(length_1 + 5);
            output.writeUInt8(type, 0);
            output.writeUInt32BE(length_1, 1);
            var position = 5;
            try {
                for (var serialized_1 = tslib_1.__values(serialized), serialized_1_1 = serialized_1.next(); !serialized_1_1.done; serialized_1_1 = serialized_1.next()) {
                    var item = serialized_1_1.value;
                    item.copy(output, position);
                    position += item.length;
                }
            }
            catch (e_4_1) { e_4 = { error: e_4_1 }; }
            finally {
                try {
                    if (serialized_1_1 && !serialized_1_1.done && (_b = serialized_1.return)) _b.call(serialized_1);
                }
                finally { if (e_4) throw e_4.error; }
            }
        }
        else if (typeof data === 'number' || data instanceof long_1.default) {
            var type = DataTypes.NUMBER;
            var length_2 = 8;
            var bufferData = (data instanceof long_1.default) ? Buffer.from(data.toBytes()) : Buffer.from(long_1.default.fromNumber(data).toBytes());
            output = Buffer.alloc(length_2 + 5);
            output.writeUInt8(type, 0);
            output.writeUInt32BE(length_2, 1);
            bufferData.copy(output, 5);
        }
        else if (typeof data === 'object') {
            if (typeof data.toByteArray === 'function') {
                // Radix objects
                output = data.toByteArray();
            }
            else {
                // Generic object
                var type = DataTypes.OBJECT;
                var length_3 = 0;
                // Serialize all properties
                // Build a map sorted by property name
                var map = new typescript_map_1.TSMap();
                for (var key in data) {
                    var serializedValue = this.toByteArray(data[key]);
                    length_3 += key.length + 1 + serializedValue.length;
                    map.sortedSet(key, serializedValue);
                }
                // Write everything to the buffer
                output = Buffer.alloc(length_3 + 5);
                output.writeUInt8(type, 0);
                output.writeUInt32BE(length_3, 1);
                var position = 5;
                try {
                    for (var _d = tslib_1.__values(map.keys()), _e = _d.next(); !_e.done; _e = _d.next()) {
                        var key = _e.value;
                        var value = map.get(key);
                        output.writeUInt8(key.length, position);
                        position++;
                        output.write(key, position);
                        position += key.length;
                        value.copy(output, position);
                        position += value.length;
                    }
                }
                catch (e_5_1) { e_5 = { error: e_5_1 }; }
                finally {
                    try {
                        if (_e && !_e.done && (_c = _d.return)) _c.call(_d);
                    }
                    finally { if (e_5) throw e_5.error; }
                }
            }
        }
        else if (typeof data === 'boolean') {
            var type = DataTypes.BOOLEAN;
            var length_4 = 1;
            output = Buffer.alloc(length_4 + 5);
            output.writeUInt8(type, 0);
            output.writeUInt32BE(length_4, 1);
            output.writeUInt8(data ? 1 : 0, 5);
        }
        else if (typeof data === 'string') {
            var type = DataTypes.STRING;
            var bufferData = Buffer.from(data, 'utf8');
            var length_5 = bufferData.length;
            output = Buffer.alloc(length_5 + 5);
            output.writeUInt8(type, 0);
            output.writeUInt32BE(length_5, 1);
            bufferData.copy(output, 5);
        }
        else if (typeof data === 'function') {
            // Ignore
        }
        else {
            RadixLogger_1.logger.trace('Unknown type', data);
        }
        return output;
    };
    return RadixSerializer;
}());
exports.default = RadixSerializer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmFkaXhTZXJpYWxpemVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL21vZHVsZXMvc2VyaWFsaXplci9SYWRpeFNlcmlhbGl6ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsaURBQXNDO0FBRXRDLG9EQWtCMEI7QUFFMUIscURBQThDO0FBRTlDLHNEQUF1QjtBQUV2QixJQUFZLFNBU1g7QUFURCxXQUFZLFNBQVM7SUFDakIsK0NBQVcsQ0FBQTtJQUNYLDZDQUFVLENBQUE7SUFDViw2Q0FBVSxDQUFBO0lBQ1YsMkNBQVMsQ0FBQTtJQUNULDZDQUFVLENBQUE7SUFDViwyQ0FBUyxDQUFBO0lBQ1QseUNBQVEsQ0FBQTtJQUNSLHlDQUFRLENBQUE7QUFDWixDQUFDLEVBVFcsU0FBUyxHQUFULGlCQUFTLEtBQVQsaUJBQVMsUUFTcEI7QUFFRDtJQUFBO0lBd1NBLENBQUM7SUF2U2lCLHdCQUFRLEdBQXRCLFVBQXVCLElBQVM7O1FBQzVCLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUNyQixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUE7O2dCQUNmLEtBQWlCLElBQUEsU0FBQSxpQkFBQSxJQUFJLENBQUEsMEJBQUEsNENBQUU7b0JBQWxCLElBQUksSUFBSSxpQkFBQTtvQkFDVCxNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTtpQkFDOUM7Ozs7Ozs7OztZQUNELE9BQU8sTUFBTSxDQUFBO1NBQ2hCO2FBQU0sSUFBSSxPQUFPLElBQUksS0FBSyxRQUFRLEVBQUU7WUFDakMsT0FBTyxlQUFlLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFBO1NBQzlDO2FBQU07WUFDSCxPQUFPLElBQUksQ0FBQTtTQUNkO0lBQ0wsQ0FBQztJQUVhLDhCQUFjLEdBQTVCLFVBQTZCLFVBQWtCO1FBQzNDLElBQUksTUFBTSxHQUFHLEVB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